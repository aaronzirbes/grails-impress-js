<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"><!--<![endif]-->
	<head>
		<meta charset="utf-8"/>
		<title>Grails Acegi to Spring Security</title>
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />
		
		
		<meta name="layout" content="impress"/>
		
		<meta name="description" content="Converting a Grails Application from Acegi to Spring Security">
		<meta name="author" content="ajz@umn.edu"/>
	
		<link href="impress.css" type="text/css" rel="stylesheet" media="screen, projection" />

	</head>
	<body>
		
		<div id="impress" class="impress-not-supported">
			<div class="fallback-message">
				<p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
				<p>For the best experience please use the latest <b>Chrome</b> or <b>Safari</b> browser. Firefox 10 (to be released soon) will also handle it.</p>
			</div>
			<div id="slide-2" class="step slide" data-x="0" data-y="0" data-z="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="3" data-scale="1.00"> <p style="font-size:220%; line-height:150%;">
	Replacing <strong>Acegi</strong> with <strong>Spring Security</strong> in a Grails 1.3.x application</p>
<p style="font-size: 220%; line-height: 150%; text-align: right; ">
	<img alt="" src="grails_logo.png" style="width: 300px; height: 90px; transform:rotate(7deg);
-ms-transform:rotate(7deg);
-moz-transform:rotate(7deg);
-webkit-transform:rotate(7deg);
-o-transform:rotate(7deg);" /></p>
<div class="slide-num">1</div></div>
<div id="slide-3" class="step slide" data-x="1000" data-y="0" data-z="0" data-rotate-x="0" data-rotate-y="-20" data-rotate-z="0" data-scale="1.00"> <p>
	<span style="font-size:200%; line-height: 200%;"><strong>Every app</strong> has some cleaning to do first!</span></p>
<div class="slide-num">2</div></div>
<div id="slide-4" class="step slide" data-x="1000" data-y="1000" data-z="-3" data-rotate-x="30" data-rotate-y="0" data-rotate-z="0" data-scale="1.00"> <p>
	Is the database structure up to spec?</p>
<p>
	<code>dbCreate = &#39;validate&#39;</code></p>
<div class="slide-num">3</div></div>
<div id="slide-5" class="step slide" data-x="0" data-y="1000" data-z="0" data-rotate-x="12" data-rotate-y="0" data-rotate-z="9" data-scale="1.00"> <p style="text-align: center; ">
	Is the SCM folder clean?</p>
<p style="text-align: center; ">
	&nbsp;</p>
<p>
	<strong>Remove</strong></p>
<p style="text-align: right; ">
	<code>.target<br />
	.classpath </code></p>
<p>
	<strong>Keep</strong></p>
<p style="text-align: right; ">
	<code>.project<br />
	.settings</code></p>
<div class="slide-num">4</div></div>
<div id="slide-6" class="step slide" data-x="0" data-y="2000" data-z="0" data-rotate-x="0" data-rotate-y="8" data-rotate-z="1" data-scale="1.00"> <p>
	&nbsp;</p>
<p>
	Make sure that <strong>grails test-app</strong> and <strong>grails run-app</strong> works.</p>
<p>
	&nbsp;</p>
<p style="text-align: right; ">
	Don&#39;t blame</p>
<p style="text-align: right; ">
	<em>the upgrade</em></p>
<p style="text-align: right; ">
	if</p>
<p style="text-align: right; ">
	<em>the app was broken</em></p>
<p style="text-align: right; ">
	before hand!</p>
<div class="slide-num">5</div></div>
<div id="slide-7" class="step slide" data-x="1000" data-y="2000" data-z="0" data-rotate-x="-5" data-rotate-y="0" data-rotate-z="-2" data-scale="1.00"> <p style="margin-top:2em;">
	Remove <strong>umn-acegi</strong> from&nbsp;<strong>application.properties</strong></p>
<p style="margin-top:2em;font-size: 130%;">
	Add the spring-security-* plugins to BuildConfig.groovy.</p>
<p style="margin-top:2em;font-size: 90%;">
	... this is the new and recommended way to add plugins to your grails application.</p>
<div class="slide-num">6</div></div>
<div id="slide-8" class="step slide" data-x="2000" data-y="2000" data-z="0" data-rotate-x="0" data-rotate-y="10" data-rotate-z="-5" data-scale="1.00"> <p>
	Spring Security Core Documenation will tell you that...</p>
<p style="font-size:200%; line-height: 2em;">
	many of the changes are covered <a href="http://grails-plugins.github.com/grails-spring-security-core/docs/manual/guide/2%20Differences%20Between%20the%20Spring%20Security%20and%20Acegi%20Plugins.html">here</a>.</p>
<div class="slide-num">7</div></div>
<div id="slide-9" class="step slide" data-x="2000" data-y="1000" data-z="0" data-rotate-x="10" data-rotate-y="0" data-rotate-z="-13" data-scale="1.00"> <div>
	<p style="font-size: 120%; margin: 1.5em;">
		The first to change is the <strong>import</strong> for the <strong>@Secured</strong> annotations.</p>
	<pre style="color: rgb(0, 0, 0); text-align: left; background-color: rgb(247, 248, 242); ">
<span class="java-keyword" style="font-weight: bold; color: rgb(0, 0, 139); ">import</span> org.codehaus.groovy.grails.plugins.springsecurity.Secured</pre>
	<div style="font-size: 120%; margin: 1.5em;">
		becomes</div>
	<div>
		<pre style="background-color: rgb(247, 248, 242); color: rgb(0, 0, 0); text-align: left; ">
<span class="java-keyword" style="font-weight: bold; color: rgb(0, 0, 139); ">import</span> grails.plugins.springsecurity.Secured</pre>
		<div>
			&nbsp;</div>
	</div>
</div>
<div class="slide-num">8</div></div>
<div id="slide-10" class="step slide" data-x="3000" data-y="1000" data-z="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-6" data-scale="1.00"> <p style="font-size: 200%; line-height:200%; margin-bottom: 1em;">
	Next up is the reference to the Security Service</p>
<p>
	the old</p>
<p style="text-align: right; ">
	<strong>authenticateService</strong></p>
<p>
	is now</p>
<p style="text-align: right; ">
	<strong>springSecurityService</strong></p>
<div class="slide-num">9</div></div>
<div id="slide-11" class="step slide" data-x="4000" data-y="1000" data-z="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-15" data-scale="1.00"> <p>Tags!</p>
<p style="font-size:200%; text-align:right; margin:1em; line-height:200%;">&lt;g:ifAnyGranted&gt;</p>
<p style="font-size:200%; text-align:left; margin:1em; line-height:200%;">&lt;g:ifAllGranted&gt;</p>

<p style="font-size:200%; text-align:center; margin:1em; line-height:200%;">&lt;g:isLoggedIn&gt;</p>
<div class="slide-num">10</div></div>
<div id="slide-12" class="step slide" data-x="4000" data-y="1000" data-z="-2000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-12" data-scale="1.00"> <p>
	Tags!</p>
<p style="font-size:200%; text-align:right; margin:1em; line-height:200%;">
	&lt;sec:ifAnyGranted&gt;</p>
<p style="font-size:200%; text-align:left; margin:1em; line-height:200%;">
	&lt;sec:ifAllGranted&gt;</p>
<p style="font-size:200%; text-align:center; margin:1em; line-height:200%;">
	&lt;sec:isLoggedIn&gt;</p>
<div class="slide-num">11</div></div>
<div id="slide-13" class="step slide" data-x="4000" data-y="2000" data-z="-1000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1.00"> <p style="text-align: center; margin-top:8em;">
	<span style="font-size:200%; font-family:courier new,courier,monospace;">grails test-app</span></p>
<div class="slide-num">12</div></div>
<div id="slide-14" class="step slide" data-x="4000" data-y="2000" data-z="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1.00"> <p style="text-align: center; margin-top:8em;">
	<span style="font-size:200%; font-family:courier new,courier,monospace;">grails run-app</span></p>
<div class="slide-num">13</div></div>
<div id="slide-15" class="step slide" data-x="4000" data-y="2000" data-z="1000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1.00"> <p style="text-align: center; margin-top:8em;">
	<span style="font-size:200%; font-family:courier new,courier,monospace;">grails prod run-app</span></p>
<div class="slide-num">14</div></div>
<div id="slide-16" class="step slide" data-x="3000" data-y="2000" data-z="1000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-8" data-scale="1.00"> <p>
	<strong>Configuration Changes</strong></p>
<ul>
	<li>
		Now <em>host dependent</em></li>
	<li>
		Stored <strong>External</strong> to the Application</li>
	<li>
		Stored in <strong>SVN</strong></li>
	<li>
		<strong>Commits</strong> to SVN will update the Application Server</li>
	<li>
		<strong>Config.groovy </strong>is now minimalistic</li>
</ul>
<div class="slide-num">15</div></div>
<div id="slide-17" class="step slide" data-x="3000" data-y="1000" data-z="1000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-8" data-scale="1.00"> <p>
	<strong>Configuration Locations</strong></p>
<p style="line-height:150%;">
	<em>the repo</em></p>
<p>
	https://svn.cccs.umn.edu/svn/grails/config/</p>
<p  style="line-height:150%; text-align: center; ">
	<em>the folders</em></p>
<p style="text-align: right; ">
	<strong>development</strong></p>
<p style="text-align: right; ">
	<strong>staging</strong></p>
<p style="text-align: right; ">
	<strong>production</strong></p>
<p>
	&nbsp;</p>
<div class="slide-num">16</div></div>
<div id="slide-18" class="step slide" data-x="2000" data-y="2000" data-z="1000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-9" data-scale="1.00"> <p>
	No more <strong>DataSource.groovy</strong></p>
<p>
	The new <strong>Config.groovy</strong></p>
<div>
	<span style="font-family:courier new,courier,monospace;">grails.config.locations = [ &quot;file:/etc/grails/active-directory.groovy&quot;,</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &quot;file:/etc/grails/shibboleth.groovy&quot;,</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &quot;file:/etc/grails/mock-config.groovy&quot;,</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &quot;file:/etc/grails/logging-config.groovy&quot;,</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &quot;file:/etc/grails/mail-config.groovy&quot;,</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &quot;file:/etc/grails/zpfour-config.groovy&quot;,</span></div>
<div>
	<span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &quot;file:/etc/grails/${appName}-config.groovy&quot; ]</span></div>
<div>
	&nbsp;</div>
<div class="slide-num">17</div></div>
<div id="slide-19" class="step slide" data-x="2000" data-y="4000" data-z="-1500" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-9" data-scale="2.00"> <div style="font-size:90%; font-weight:bold; background-color:#000000; color:#080; font-family:courier new,courier,monospace;">
	<pre>
grails.config.locations = [
    &quot;file:/etc/grails/active-directory.groovy&quot;,
    &quot;file:/etc/grails/shibboleth.groovy&quot;,
    &quot;file:/etc/grails/mock-config.groovy&quot;,
    &quot;file:/etc/grails/logging-config.groovy&quot;,
    &quot;file:/etc/grails/mail-config.groovy&quot;,
    &quot;file:/etc/grails/zpfour-config.groovy&quot;,
    &quot;file:/etc/grails/${appName}-config.groovy&quot; ]

grails.mime.file.extensions = true
grails.mime.use.accept.header = false
grails.mime.types = [ ... ]
grails.views.default.codec=&quot;none&quot;
grails.views.gsp.encoding=&quot;UTF-8&quot;
grails.converters.encoding=&quot;UTF-8&quot;
grails.enable.native2ascii = true
</pre>
</div>
<p>
	&nbsp;</p>
<div class="slide-num">18</div></div>
<div id="slide-20" class="step slide" data-x="2000" data-y="5000" data-z="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-12" data-scale="1.00"> <p>
	Prep the <strong>Application Server</strong></p>
<p style="text-align: right; ">
	<strong>...in</strong></p>
<p>
	/etc/apache2/sites-enabled/tomcat6-ssl</p>
<p style="text-align: right; ">
	<strong>...add</strong></p>
<p>
	&nbsp;</p>
<div>
	<strong><span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &lt;Location &quot;/appname&quot;&gt;</span></strong></div>
<div>
	<strong><span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; AuthType shibboleth</span></strong></div>
<div>
	<strong><span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; ShibRequestSetting requireSession 1</span></strong></div>
<div>
	<strong><span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; Require valid-user</span></strong></div>
<div>
	<strong><span style="font-family:courier new,courier,monospace;">&nbsp; &nbsp; &lt;/Location&gt;</span></strong></div>
<div style="text-align: right; ">
	...then</div>
<div>
	<span style="font-family:courier new,courier,monospace;"><strong>sudo service apache2 restart</strong></span></div>
<div class="slide-num">19</div></div>
<div id="slide-21" class="step slide" data-x="2000" data-y="4000" data-z="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-17" data-scale="1.00"> <p>
	Deploy the app.</p>
<p>
	... and most importantly</p>
<div class="slide-num">20</div></div>
<div id="slide-22" class="step slide" data-x="0" data-y="5000" data-z="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1.00"> <p style="padding:100px; font-size: 300%; text-align: center; ">
	Check</p>
<div class="slide-num">21</div></div>
<div id="slide-23" class="step slide" data-x="0" data-y="5000" data-z="-500" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1.00"> <p style="padding:100px; font-size: 300%; text-align: center; ">
	The</p>
<div class="slide-num">22</div></div>
<div id="slide-24" class="step slide" data-x="0" data-y="5000" data-z="-1000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1.00"> <p style="padding:100px; font-size: 300%; text-align: center; ">
	Server Logs!</p>
<div class="slide-num">23</div></div>
<div id="slide-25" class="step slide" data-x="0" data-y="5000" data-z="-1500" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1.00"> <p style="padding:100px; font-size: 300%; text-align: center; ">
	Where?</p>
<p style="font-size: 150%; text-align: center; ">
	<span style="font-family:courier new,courier,monospace;">/var/log/tomcat6/catalina.out</span></p>
<div class="slide-num">24</div></div>
<div id="slide-26" class="step slide" data-x="-1000" data-y="5000" data-z="-1500" data-rotate-x="0" data-rotate-y="0" data-rotate-z="4" data-scale="1.00"> <p style="padding: 120px; font-size: 200%; line-height:200%; color: blue; font-weight: bold; text-align: center; transform:rotate(7deg);
-ms-transform:rotate(7deg);
-moz-transform:rotate(7deg);
-webkit-transform:rotate(7deg);
-o-transform:rotate(7deg);">
	Thank for your patience!</p>
<div class="slide-num">25</div></div>

		</div>
		
		<div class="hint"><p>Use a spacebar or arrow keys to navigate</p></div>
		
	
		<script src="impress.js" type="text/javascript" ></script>

	</body>
</html>
